# v1.1.0 - Criterios de Aceptación

**Feature**: Nuevos parámetros de búsqueda en `search_laws_list`
**Fecha**: 2025-11-30
**Metodología**: RPVEA 2.0

---

## R - Requisitos

### Parámetros a Implementar (Alta Prioridad)

| Parámetro | Campo API | Descripción |
|-----------|-----------|-------------|
| `rango_codigo` | `rango@codigo` | Filtrar por tipo de norma |
| `materia_codigo` | `materia@codigo` | Filtrar por temática |
| `numero_oficial` | `numero_oficial` | Búsqueda exacta por número |

### Datos de Referencia (Consultados de API)

#### Códigos de Rango (Tabla: `rangos`)

| Código | Descripción | Uso Frecuente |
|--------|-------------|---------------|
| 1070 | Constitución | |
| 1290 | Ley Orgánica | ⭐ |
| 1300 | Ley | ⭐⭐⭐ |
| 1310 | Real Decreto Legislativo | |
| 1320 | Real Decreto-ley | ⭐⭐ |
| 1340 | Real Decreto | ⭐⭐ |
| 1350 | Orden | ⭐ |
| 1370 | Resolución | |
| 1450 | Ley Foral | |
| 1470 | Decreto Legislativo | |
| 1500 | Decreto-ley | |

**Nota importante**:
- ⚠️ 1290 = Ley Orgánica (NO 1310)
- ⚠️ 1340 = Real Decreto (NO 1200)
- ⚠️ 1320 = Real Decreto-ley (NO 1240)

#### Códigos de Ámbito (Tabla: `ambitos`)

| Código | Descripción |
|--------|-------------|
| 1 | Estatal |
| 2 | Autonómico |

**Nota**: La API NO tiene código 3 para "Europeo" aunque el MCP lo expone.

#### Códigos de Materia (Tabla: `materias`)

Total: **6831 materias**

Ejemplos relevantes:
| Código | Descripción |
|--------|-------------|
| 113 | Agencia de Protección de Datos |
| 6000 | Registro General de Protección de Datos |
| 7908 | Agencia Española de Protección de Datos |

---

## P - Plan de Validación

### Casos de Prueba

| ID | Parámetro | Entrada | Resultado Esperado |
|----|-----------|---------|-------------------|
| TC01 | rango_codigo | "1300" | Solo Leyes |
| TC02 | rango_codigo | "1290" | Solo Leyes Orgánicas |
| TC03 | materia_codigo | "113" | Normas de AEPD |
| TC04 | numero_oficial | "39/2015" | BOE-A-2015-10565 |
| TC05 | numero_oficial | "40/2015" | BOE-A-2015-10566 |
| TC06 | rango_codigo + ambito | "1290" + "Estatal" | LO Estatales |

### Criterios de Aceptación

#### CA-01: Parámetros en Schema MCP
- [ ] `rango_codigo` aparece en el schema de `search_laws_list`
- [ ] `materia_codigo` aparece en el schema de `search_laws_list`
- [ ] `numero_oficial` aparece en el schema de `search_laws_list`

#### CA-02: Queries Generadas Correctamente
- [ ] `rango_codigo="1300"` genera `rango@codigo:"1300"` en query
- [ ] `materia_codigo="113"` genera `materia@codigo:"113"` en query
- [ ] `numero_oficial="39/2015"` genera `numero_oficial:"39/2015"` en query

#### CA-03: Resultados Filtrados
- [ ] TC01: 100% de resultados tienen `rango.codigo = "1300"`
- [ ] TC04: Resultado contiene `BOE-A-2015-10565`

#### CA-04: Combinaciones Funcionan
- [ ] TC06: Resultados son Ley Orgánica (1290) Y Estatal

#### CA-05: Documentación Correcta
- [ ] Docstring tiene códigos correctos (1290=LO, no 1310)
- [ ] Docstring referencia `get_auxiliary_table("rangos")`

---

## V - Validación

### V1 - API Directa (curl)

```bash
# TC01: rango_codigo
curl -s "https://www.boe.es/datosabiertos/api/legislacion-consolidada?limit=3&query=..."

# Resultado: ✅ PASS - Solo devuelve Leyes
```

### V2 - MCP Local (Python)

```bash
.venv/bin/python tests/test_v110_validation.py

# Resultado esperado: 4/4 tests passed
```

### V3 - MCP Inspector

```bash
npx @anthropic/mcp-inspector .venv/bin/python -m boe_mcp.server

# Verificar visualmente:
# 1. Tools listados correctamente
# 2. Nuevos parámetros en schema
# 3. Llamadas funcionan
```

---

## E - Ejecución

### Archivos Modificados

| Archivo | Cambio |
|---------|--------|
| `src/boe_mcp/server.py` | Añadir 3 parámetros + lógica de query |
| `docs/BOE_MCP_DEVELOPMENT_FRAMEWORK.md` | Documentar metodología |
| `tests/test_v110_validation.py` | Tests V2 |
| `tests/test_v3_e2e.py` | Tests V3 |

### Verificación de Implementación

- [ ] Códigos en docstring son correctos (verificado vs tabla auxiliar)
- [ ] Query genera sintaxis correcta `campo@codigo:"valor"`
- [ ] Parámetros se combinan con `and`

---

## A - Aceptación

### Checklist Final

- [ ] Todos los CA-XX verificados
- [ ] V1 pasa (API directa)
- [ ] V2 pasa (4/4 tests)
- [ ] V3 pasa (MCP Inspector)
- [ ] Código sin errores de lint
- [ ] PR creado con descripción completa

### Registro de Validación para PR

```markdown
## Validación RPVEA 2.0

### Requisitos
- [x] Códigos consultados de tablas auxiliares
- [x] Criterios de aceptación definidos

### Validación
- [x] V1: API directa (curl) - 3/3 campos funcionan
- [x] V2: MCP Local - 4/4 tests pasan
- [ ] V3: MCP Inspector - Pendiente

### Criterios de Aceptación
- [ ] CA-01: Parámetros en schema
- [ ] CA-02: Queries correctas
- [ ] CA-03: Filtrado funciona
- [ ] CA-04: Combinaciones funcionan
- [ ] CA-05: Documentación correcta
```
